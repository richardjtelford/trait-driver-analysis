---
title: "Supplementary Inofrmation - Assessing generality in trait-based ecology and theory by using experimental warming and transplant communities spanning a broad temperature gradient"

author: |
  | Brian J. Enquist^[Corresponding author: brian.enquist@uoa.com] $^1$, Brian S. Maitner$^1$, Aud H. Halbritter$^{4,5}$,
  | Richard J.Telford$^{4,5}$, Lorah Seltzer$^1$, Vanessa Buzzard$^1$,
  | Jonathan Henn, Sean Michaletz, Inge H.J. Althuizen$^4$,
  | Kine Blom$^4$, Alex Brummer, Julia Chacon$^1$,
  | Javiera Seaman Espinosa, Bárbara William Garcia$^4$, Ragnhild Gya$^{4,5}$,
  | Elisabeth Nesheim Hauge$^4$, Hai He, Francesca Jaroszynska$^4$,
  | Blake L. Joyce7, Kari Klanderud$^3$, Frida Knoop$^4$,
  | Hanna Lee, Rebecca Lehman, Miguel Muñoz Mazon,
  | Michelangelo Sergio Moerland, Linda Hovde Nordås$^4$,
  | Ahui Peng$^6$, Christine Pötsch$^4$, Claire Ponsac, Fei Ran$^6$,
  | Ruben Roos$^3$, Christien Steyn, Megan Kathleen
  | Sullivan, Xiangyang Sun$^6$, Jesslyn Tjendra$^4$, Yao Xiao$^6$,
  | Li Zhang$^6$, Xiaoxiang Zhao$^6$, Yan Yang$^6$ & Vigdis Vandvik$^{4,5}$

address: |
 | $^1$ Department of Ecology and Evolutionary Biology, University of Arizona, AZ, USA
 | $^2$ The Santa Fe Institute, Santa Fe, NM, USA
 | $^3$ Faculty of Environmental Sciences and Natural Resource Management, Norwegian University of Life Sciences, Norway,
 | $^4$ Department of Biological Sciences, University of Bergen, Norway,
 | $^5$ Bjerknes Centre for Climate Research, University of Bergen, Norway
 | $^6$ Institute of Mountain Hazards and Environment (CAS), China.
 | $^7$ University Information Technology Services, University of Arizona, AZ, USA


date: "`r format(Sys.Date(), '%d %B %Y')`"

output: 
  #pdf_document
  bookdown::pdf_book:
    dev: cairo_pdf
    toc: no
    number_sections: false
    latex_engine: lualatex
  fig_caption: yes
  extra_dependencies: ["flafter"]
  header-includes:
    - \usepackage{caption}
    - \usepackage{booktabs}
    - \usepackage{longtable}
classoption: a4paper
bibliography: Rmd/TDT2.bib
csl: Rmd/elsevier-harvard_rjt.csl


---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
library("drake")
library("cairoDevice")
library(kableExtra)
library(patchwork)

```

## Supplementary

This section contains all plots and tables of the supplementary material of this manuscript.


### Trait correlation

```{r trait-cor, eval = TRUE, echo = FALSE, fig.height=7, fig.cap="Correlation coefficient between each trait combination. Correlation coefficients are shown for trait combinations with a significnat correlarion."}
readd(trait_corr)
```



### Trait change over time

```{r hist-all-1, eval = TRUE, echo = FALSE, fig.height=7, fig.cap="Histogram for mean trait values over time."}
loadd(hist_mass_w, hist_area_w, hist_C_w, hist_mass_c, hist_area_c, hist_C_c)
(hist_mass_w + hist_mass_c) /
(hist_area_w + hist_area_c) /
(hist_C_w + hist_C_c)

```

```{r hist-all-2, eval = FALSE, echo = FALSE, fig.height=7, fig.cap="Histogram for mean trait values over time."}
loadd(hist_N_w, hist_N_c, hist_P_w, hist_P_c, hist_NP_w, hist_NP_c)
  (hist_N_w + hist_N_c) /
    (hist_P_w + hist_P_c) /
    (hist_NP_w + hist_NP_c)
```

```{r hist-all-3, eval = FALSE, echo = FALSE, fig.cap="Histogram for mean trait values over time."}
loadd(hist_C13_w, hist_C13_c, hist_N15_w, hist_N15_c, hist_CN_w, hist_CN_c)
  (hist_C13_w + hist_C13_c) /
    (hist_N15_w + hist_N15_c) /
    (hist_CN_w + hist_CN_c)
```

<!-- ### Colonization and extinction over time -->

```{r col-ext-time-plot, eval = FALSE, echo = FALSE, fig.cap="Number of species colonizing and going extinct over time in each climate treatment."}
readd(col_ext_over_time_plot)
```


\newpage
### Convergence and divergence for traits with no relationship along climate gradient

```{r conv-div-no-slope-plot, eval = TRUE, echo = FALSE, fig.height=4, fig.width=6, fig.cap="Testing for convergence and divergence in each pair-wise trait value as a function of year since transplant. Temporal variation in effect sizes for each measured trait. The first column shows traits divergence and the second column trait convergence. The grey panels labeled with Positive slope, No slope and Negative slopes show the predicted outcome according to TDT, depending on the traits relationship with summer air temperature (see New Fig. 2). The colour of the lines indicates the transplant treatment: transplant to 1.75°C warmer (red), transplant to 0.5°C warmer (pink), OTC (orange), transplant to 0.5°C colder (light blue), transplant to 1.75°C colder (dark blue). Solid lines indicate a significant change in effect size over time."}
readd(conv_div_no_slope_plot)
```


### Stats for convergence and divergence analysis

Results from the statistical analysis of the fixed traits.

```{r conv-div_table-1, eval = TRUE, echo = FALSE}
loadd(treatment_effect_table)
df_f = treatment_effect_table %>%
  mutate(direction = factor(direction, levels = c("divergence", "convergence"))) %>% 
  filter(plasticity == "fixed")

kbl(df_f %>% select(-plasticity, -direction), longtable = TRUE, booktabs = TRUE) %>%
  pack_rows("convergence", 1, nrow(df_f %>% filter(direction == "convergence"))) %>% 
  pack_rows("divergence", nrow(df_f %>% filter(direction == "convergence")) + 1, nrow(df_f)) %>% 
  kable_styling(latex_options = c("repeat_header"), font_size = 7)

```


Results from the statistical analysis of the plastic traits.

```{r conv-div_table-2, eval = TRUE, echo = FALSE}
loadd(treatment_effect_table)
df_pl = treatment_effect_table %>%
  mutate(direction = factor(direction, levels = c("divergence", "convergence"))) %>% 
  filter(plasticity == "plastic")

df_pl %>% 
  select(-plasticity, -direction) %>% 
  kbl(longtable = TRUE, booktabs = TRUE) %>%
  pack_rows("convergence", 1, nrow(df_pl %>% filter(direction == "convergence"))) %>% 
  pack_rows("divergence", nrow(df_pl %>% filter(direction == "convergence")) + 1, nrow(df_pl)) %>% 
  kable_styling(latex_options = c("repeat_header"), font_size = 7)
  
```


### Eucledian distance analysis

```{r eucledian_plot, eval = TRUE, echo = FALSE, fig.cap="Euclidean distance in functional trait composition since transplant (2012 - 2016) for control plots and treatments at each site. The colours indicate the different treatments control (grey), transplant to 1.75°C warmer (red), transplant to 0.5°C warmer (pink), OTC (orange), transplant to 0.5°C colder (light blue), transplant to 1.75°C colder (dark blue). The two columns show two scenarios of trait plasticity. Divergence reflects a conservative scenario, where treatments are compared to the origin control and do not allow for trait plasticity. Contrary, convergence reflects full plasticity where treatments are compared to the destination controls."}
readd(euclidean_distance_plot)
```


```{r eucledian_table, eval = TRUE, echo = FALSE}
loadd(euclidean_dist_table)

euclidean_dist_table %>%
  kbl(caption = "Results testing difference between eucledian distance for control plots and each treatment at each site between 2012 and 2016.")

```



### All the happy moments

This section shows the results from the analysis on the happy moments.
We show the change in the happy moments over time for each treatment, nike plots fro all controls plots and all the treatments and finally a table with mean and SE for each moment by trait, site and treatment.


```{r full_happymoment_plot, eval = TRUE, echo = FALSE, fig.cap="Change in mean, variance, skewness, kurtosis and range for leaf area, thickness, phosphorus, and C and N isotopes in each treatment and over time. Shown are mean values for each time period and climate treatment with standard error."}
readd(full_happymoment_plot)
```


Nike plots showing skewness versus kurtosis for all the controls

```{r nike_1, eval = TRUE, echo = FALSE, fig.cap="Skewness versus kurtosis for all traits in the control plots across the gradient."}
readd(nike_plot_controls)
```


Nike plots showing skewness versus kurtosis for all the treatment plots.

```{r nike_2, eval = TRUE, echo = FALSE, fig.cap="Skewness versus kurtosis for all traits and treatemnts across the gradient."}
readd(nike_plot_treatments)
```


Table with the summary the mean and SE for all happy moments in 2016 at the destination site


```{r moment_sum, eval = FALSE, echo = FALSE}
loadd(moment_summary)

kbl(moment_summary, longtable = TRUE, booktabs = TRUE,
    caption = "Mean and SE of each moment, trait and destination site combinaiton in 2016.") %>%
  kable_styling(latex_options = c("repeat_header"), font_size = 7)
  
```

