---
title: "Assessing generality in trait-based ecology and theory by using experimental warming and transplant communities spanning a broad temperature gradient"

author: |
  | Brian J. Enquist^[Corresponding author: brian.enquist@uoa.com] $^1$, Brian S. Maitner$^1$, Aud H. Halbritter$^{4,5}$,
  | Richard J.Telford$^{4,5}$, Lorah Seltzer$^1$, Vanessa Buzzard$^1$,
  | Jonathan Henn, Sean Michaletz, Inge H.J. Althuizen$^4$,
  | Kine Blom$^4$, Alex Brummer, Julia Chacon$^1$,
  | Javiera Seaman Espinosa, Bárbara William Garcia$^4$, Ragnhild Gya$^{4,5}$,
  | Elisabeth Nesheim Hauge$^4$, Hai He, Francesca Jaroszynska$^4$,
  | Blake L. Joyce7, Kari Klanderud$^3$, Frida Knoop$^4$,
  | Hanna Lee, Rebecca Lehman, Miguel Muñoz Mazon,
  | Michelangelo Sergio Moerland, Linda Hovde Nordås$^4$,
  | Ahui Peng$^6$, Christine Pötsch$^4$, Claire Ponsac, Fei Ran$^6$,
  | Ruben Roos$^3$, Christien Steyn, Megan Kathleen
  | Sullivan, Xiangyang Sun$^6$, Jesslyn Tjendra$^4$, Yao Xiao$^6$,
  | Li Zhang$^6$, Xiaoxiang Zhao$^6$, Yan Yang$^6$ & Vigdis Vandvik$^{4,5}$

address: |
 | $^1$ Department of Ecology and Evolutionary Biology, University of Arizona, AZ, USA
 | $^2$ The Santa Fe Institute, Santa Fe, NM, USA
 | $^3$ Faculty of Environmental Sciences and Natural Resource Management, Norwegian University of Life Sciences, Norway,
 | $^4$ Department of Biological Sciences, University of Bergen, Norway,
 | $^5$ Bjerknes Centre for Climate Research, University of Bergen, Norway
 | $^6$ Institute of Mountain Hazards and Environment (CAS), China.
 | $^7$ University Information Technology Services, University of Arizona, AZ, USA


date: "`r format(Sys.Date(), '%d %B %Y')`"

output: 
  #pdf_document
  bookdown::pdf_book:
    dev: cairo_pdf
    toc: no
    number_sections: false
    latex_engine: lualatex
  fig_caption: yes
  extra_dependencies: ["flafter"]
  header-includes:
    - \usepackage{caption}
    - \usepackage{booktabs}
    - \usepackage{longtable}
classoption: a4paper
bibliography: Rmd/TDT2.bib
csl: Rmd/elsevier-harvard_rjt.csl


---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE)
library("drake")
library("cairoDevice")
library(kableExtra)

```

\newpage

## Methods

This section contains the experimental design and all the references used for the data analysis of this manuscript.

Map of study location, conceptual figure of the experimental design and bootstrapping approach.


```{r concept-fig, out.width = '100%', fig.cap="Conceptual figure showing the experimetnal design with traits changing along a gradienta and transplanting traits along the gradient. Trait imputation, bootstrapping and higher moments. And divergence - convergence."}

knitr::include_graphics("./images/TDT.png")

```


### Software

All analyses were done in R v. `r getRversion()` [@R] and used
traitstrap v. `r packageVersion("traitstrap")` [@traitstrap] to impute traits,
e1071 v. `r packageVersion("e1071")` [@e1071] to calculate moments,
and tidyverse v. `r packageVersion("tidyverse")` [@tidyverse].
Packages drake v. `r packageVersion("drake")` [@drake],
rmarkdown `r packageVersion("rmarkdown")` [@rmarkdown1] and
renv v. `r packageVersion("renv")` [@renv] were used to ensure reproducibility.
Code to reproduce all the analyses is archived at [https://github.com/richardjtelford/trait-driver-analysis](https://github.com/richardjtelford/trait-driver-analysis).

\newpage

## Results

This section contains all figures and tables of the main manuscript. The figures show responses in plant community composition and plant functional trait composition to climate  and climate change treatments.


### Trait-climate correlations

This figure shows the correlation of trait mean and temperature, representing the elevational gradient.


```{r trait-climate, fig.cap="Relationship between functional traits and summer air temperature (2m above ground). The trait values are bootstrapped community weighted traits from control plots in 2016. The regression line is shown (grey dashed) and significant relationships are indicated with a solid red line. The shaded area displays the confidence interval. The traits are sorted from positive slope, no significant to negative slope."}
readd(moments_by_climate_plot)
```

\newpage

Regression results of the climate-trait relationship.

```{r trait-climate-table}
loadd(moments_by_climate_table)

moments_by_climate_table %>%
  kbl(caption = "Results from regression of traits and summer air temperature. Shown are estimates (slope), standard error, t value and P value. Significant P values are indicated with asterisks: ** P value < 0.01, * p < 0.05")

```

\newpage


This is a principle component analysis showing plant community composition for the different treatments in all sites.

```{r trait-ordination-plot, fig.width = 8, fig.height = 7, fig.cap="Multivariate principal component analysis of community composition for each climate treatment along the elevational gradient sites."}
readd(ordination)
```


\newpage

### Colonization and extinction

Here we present the number of species that colonize and go extinct in the different climate treatments.

```{r colo-ext-plot, fig.cap="Realized (closed bar) and expected (open bar) colonization (up) or extinction (down) for each climate treatment. Colonization and extinction are expressed as mean number of species per plot and treatment."}
readd(colo_extinction_plot)
```

Here we present the abundance of species that colonize and go extinct in the different climate treatments.

```{r colo-ext-plot2, fig.cap="Realized (closed bar) and expected (open bar) colonization (up) or extinction (down) for each climate treatment. Colonization and extinction are expressed as mean abundance per plot and treatment."}
readd(colo_ext_abundance_plot)
```

\newpage

### Convergence and divergence


```{r temp-trait-hist, fig.cap="Histogram for mean trait value over time."}
readd(temporal_trait_histograms)
```

```{r conv-div-plot, fig.height=7, fig.cap="Testing for convergence and divergence in each pair-wise trait value as a function of year since transplant. Temporal variation in effect sizes for each measured trait. The first column shows traits divergence and the second column trait convergence. The grey panels labeled with Positive slope, No slope and Negative slopes show the predicted outcome according to TDT, depending on the traits relationship with summer air temperature (see New Fig. 2). The colour of the lines indicates the transplant treatment: transplant to 1.75°C warmer (red), transplant to 0.5°C warmer (pink), OTC (orange), transplant to 0.5°C colder (light blue), transplant to 1.75°C colder (dark blue). Solid lines indicate a significant change in effect size over time."}
readd(conv_div_plot)
```

\newpage

```{r rda-plot, fig.cap="Testing for convergence in multivariate community (first column) or trait-space (second and third column) as a function of year since transplant. Results from  Principal Response Curve multivariate RDA analysis. "}

loadd(wc2, wf2, wf3, wp2, wp3, cc2, cf2, cf3, cp2, cp3)

#patchwork together
((wc2 + wf2 + wf3 + wp2 + wp3) +
                guide_area() +
                plot_layout(widths = c(4, 4, 1, 4, 1),
                            guides = 'keep', heights = c(10, 0.3))) / ((cc2 + cf2 + cf3 + cp2 + cp3) +
                                                   guide_area() +
                                                      plot_layout(widths = c(4, 4, 1, 4, 1),
                                                                  guides = 'keep', heights = c(10, 0.3)))
```



```{r rda-result}

loadd(result_rda)
result_rda %>%
  kbl(caption = "Results from RDA, testing difference in species or fixed/plastic trait composition over time among climate treatments and the origin control turfs using a permutation test with 999 permutations.")

```

```{r rda-proportion}

loadd(rda_proportions)
rda_proportions %>%
  kbl(caption = "Proportion convergence towards destination site after 4 years of climate warming or cooling.", digits = 2)

```



```{r skewness-plot, fig.cap="Deviation from global mean vs. change in skewness over time"}

readd(skewness_plot)
```

```{r half-happymoment-plot, fig.cap="Change in mean and skewness for leaf area, thickness, phosphorus, and C and N isotopes in each treatment and over time. Shown are mean values for each time period and climate treatment with standard error."}
readd(half_happymoment_plot)
```




## References
